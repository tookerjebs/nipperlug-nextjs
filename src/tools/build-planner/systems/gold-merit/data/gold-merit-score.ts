// Gold Merit Score Calculator
// Calculates required merit score based on merit points needed

/**
 * Merit Score Formula data extracted from MeritSystem.txt
 * Format: [FormulaIndex, Min_MeritScore, Max_MeritScore, Reward_MeritPoint]
 * 
 * To get N merit points, you need to accumulate points from ranges.
 * For example:
 * - 0-50 merit score = 1 point
 * - 50-100 merit score = 1 more point (total 2)
 * - 100-150 merit score = 1 more point (total 3)
 * etc.
 */
const MERIT_SCORE_FORMULA: Array<[number, number, number, number]> = [
  [0, 0, 50, 1],
  [1, 50, 100, 1],
  [2, 100, 150, 1],
  [3, 150, 200, 1],
  [4, 200, 250, 1],
  [5, 250, 300, 1],
  [6, 300, 350, 1],
  [7, 350, 410, 1],
  [8, 410, 470, 1],
  [9, 470, 530, 1],
  [10, 530, 590, 1],
  [11, 590, 650, 1],
  [12, 650, 710, 1],
  [13, 710, 770, 1],
  [14, 770, 830, 1],
  [15, 830, 890, 1],
  [16, 890, 950, 1],
  [17, 950, 1010, 1],
  [18, 1010, 1080, 1],
  [19, 1080, 1150, 1],
  [20, 1150, 1220, 1],
  [21, 1220, 1290, 1],
  [22, 1290, 1360, 1],
  [23, 1360, 1430, 1],
  [24, 1430, 1500, 1],
  [25, 1500, 1570, 1],
  [26, 1570, 1640, 1],
  [27, 1640, 1710, 1],
  [28, 1710, 1790, 1],
  [29, 1790, 1870, 1],
  [30, 1870, 1950, 1],
  [31, 1950, 2030, 1],
  [32, 2030, 2110, 1],
  [33, 2110, 2190, 1],
  [34, 2190, 2270, 1],
  [35, 2270, 2350, 1],
  [36, 2350, 2440, 1],
  [37, 2440, 2530, 1],
  [38, 2530, 2620, 1],
  [39, 2620, 2710, 1],
  [40, 2710, 2800, 1],
  [41, 2800, 2890, 1],
  [42, 2890, 2980, 1],
  [43, 2980, 3070, 1],
  [44, 3070, 3170, 1],
  [45, 3170, 3270, 1],
  [46, 3270, 3370, 1],
  [47, 3370, 3470, 1],
  [48, 3470, 3570, 1],
  [49, 3570, 3670, 1],
  [50, 3670, 3780, 1],
  [51, 3780, 3890, 1],
  [52, 3890, 4000, 1],
  [53, 4000, 4110, 1],
  [54, 4110, 4220, 1],
  [55, 4220, 4330, 1],
  [56, 4330, 4440, 1],
  [57, 4440, 4560, 1],
  [58, 4560, 4680, 1],
  [59, 4680, 4800, 1],
  [60, 4800, 4920, 1],
  [61, 4920, 5040, 1],
  [62, 5040, 5170, 1],
  [63, 5170, 5300, 1],
  [64, 5300, 5430, 1],
  [65, 5430, 5560, 1],
  [66, 5560, 5690, 1],
  [67, 5690, 5830, 1],
  [68, 5830, 5970, 1],
  [69, 5970, 6110, 1],
  [70, 6110, 6250, 1],
  [71, 6250, 6390, 1],
  [72, 6390, 6540, 1],
  [73, 6540, 6690, 1],
  [74, 6690, 6840, 1],
  [75, 6840, 6990, 1],
  [76, 6990, 7140, 1],
  [77, 7140, 7300, 1],
  [78, 7300, 7460, 1],
  [79, 7460, 7620, 1],
  [80, 7620, 7780, 1],
  [81, 7780, 7950, 1],
  [82, 7950, 8120, 1],
  [83, 8120, 8290, 1],
  [84, 8290, 8460, 1],
  [85, 8460, 8640, 1],
  [86, 8640, 8820, 1],
  [87, 8820, 9000, 1],
  [88, 9000, 9190, 2],
  [89, 9190, 9380, 2],
  [90, 9380, 9570, 2],
  [91, 9570, 9760, 2],
  [92, 9760, 9960, 2],
  [93, 9960, 10160, 2],
  [94, 10160, 10360, 2],
  [95, 10360, 10570, 2],
  [96, 10570, 10780, 2],
  [97, 10780, 10990, 2],
  [98, 10990, 11200, 2],
  [99, 11200, 11420, 2],
  [100, 11420, 11640, 2],
  [101, 11640, 11860, 2],
  [102, 11860, 12090, 2],
  [103, 12090, 12320, 2],
  [104, 12320, 12550, 2],
  [105, 12550, 12790, 2],
  [106, 12790, 13030, 2],
  [107, 13030, 13280, 2],
  [108, 13280, 13530, 2],
  [109, 13530, 13780, 2],
  [110, 13780, 14040, 2],
  [111, 14040, 14300, 2],
  [112, 14300, 14560, 2],
  [113, 14560, 14830, 2],
  [114, 14830, 15100, 2],
  [115, 15100, 15380, 2],
  [116, 15380, 15660, 2],
  [117, 15660, 15940, 2],
  [118, 15940, 16230, 2],
  [119, 16230, 16520, 2],
  [120, 16520, 16820, 2],
  [121, 16820, 17120, 2],
  [122, 17120, 17430, 2],
  [123, 17430, 17740, 2],
  [124, 17740, 18060, 2],
  [125, 18060, 18380, 2],
  [126, 18380, 18710, 2],
  [127, 18710, 19040, 2],
  [128, 19040, 19380, 2],
  [129, 19380, 19720, 2],
  [130, 19720, 20070, 2],
  [131, 20070, 20420, 2],
  [132, 20420, 20780, 2],
  [133, 20780, 21140, 2],
  [134, 21140, 21510, 2],
  [135, 21510, 21880, 2],
  [136, 21880, 22260, 3],
  [137, 22260, 22640, 3],
  [138, 22640, 23030, 3],
  [139, 23030, 23430, 3],
  [140, 23430, 23830, 3],
  [141, 23830, 24240, 3],
  [142, 24240, 24650, 3],
  [143, 24650, 25070, 3],
  [144, 25070, 25500, 3],
  [145, 25500, 25930, 3],
  [146, 25930, 26370, 3],
  [147, 26370, 26820, 3],
  [148, 26820, 27270, 3],
  [149, 27270, 27730, 3],
  [150, 27730, 28200, 3],
  [151, 28200, 28670, 3],
  [152, 28670, 29150, 3],
  [153, 29150, 29640, 3],
  [154, 29640, 30130, 3],
  [155, 30130, 30630, 3],
  [156, 30630, 31140, 3],
  [157, 31140, 31660, 3],
  [158, 31660, 32180, 3],
  [159, 32180, 32710, 3],
  [160, 32710, 33250, 3],
  [161, 33250, 33800, 3],
  [162, 33800, 34360, 3],
  [163, 34360, 34930, 4],
  [164, 34930, 35500, 4],
  [165, 35500, 36080, 4],
  [166, 36080, 36670, 4],
  [167, 36670, 37270, 4],
  [168, 37270, 37880, 4],
  [169, 37880, 38500, 4],
  [170, 38500, 39130, 4],
  [171, 39130, 39770, 4],
  [172, 39770, 40420, 4],
  [173, 40420, 41080, 4],
  [174, 41080, 41750, 4],
  [175, 41750, 42430, 4],
  [176, 42430, 43120, 4],
  [177, 43120, 43820, 4],
  [178, 43820, 44530, 4],
  [179, 44530, 45250, 4],
  [180, 45250, 45980, 4],
  [181, 45980, 46720, 4],
  [182, 46720, 47470, 4],
  [183, 47470, 48230, 5],
  [184, 48230, 49000, 5],
  [185, 49000, 49790, 5],
  [186, 49790, 50590, 5],
  [187, 50590, 51400, 5],
  [188, 51400, 52220, 5],
  [189, 52220, 53050, 5],
  [190, 53050, 53900, 5],
  [191, 53900, 54760, 5],
  [192, 54760, 55630, 5],
  [193, 55630, 56510, 5],
  [194, 56510, 57410, 5],
  [195, 57410, 58320, 5],
  [196, 58320, 59240, 5],
  [197, 59240, 60180, 5],
  [198, 60180, 61130, 6],
  [199, 61130, 62100, 6],
  [200, 62100, 63080, 6],
  [201, 63080, 64080, 6],
  [202, 64080, 65090, 6],
  [203, 65090, 66120, 6],
  [204, 66120, 67160, 6],
  [205, 67160, 68220, 6],
  [206, 68220, 69290, 6],
  [207, 69290, 70380, 6],
  [208, 70380, 71490, 6],
  [209, 71490, 72610, 6],
  [210, 72610, 73750, 7],
  [211, 73750, 74910, 7],
  [212, 74910, 76080, 7],
  [213, 76080, 77270, 7],
  [214, 77270, 78480, 7],
  [215, 78480, 79710, 7],
  [216, 79710, 80960, 7],
  [217, 80960, 82220, 7],
  [218, 82220, 83500, 7],
  [219, 83500, 84800, 7],
  [220, 84800, 86120, 7],
  [221, 86120, 87460, 8],
  [222, 87460, 88820, 8],
  [223, 88820, 90200, 8],
  [224, 90200, 91600, 8],
  [225, 91600, 93020, 8],
  [226, 93020, 94470, 8],
  [227, 94470, 95940, 8],
  [228, 95940, 97430, 8],
  [229, 97430, 98940, 8],
  [230, 98940, 100470, 9],
  [231, 100470, 102030, 9],
  [232, 102030, 103610, 9],
  [233, 103610, 105210, 9],
  [234, 105210, 106840, 9],
  [235, 106840, 108490, 9],
  [236, 108490, 110170, 9],
  [237, 110170, 111870, 9],
  [238, 111870, 113600, 10],
  [239, 113600, 115350, 10],
  [240, 115350, 117130, 10],
  [241, 117130, 118940, 10],
  [242, 118940, 120770, 10],
  [243, 120770, 122630, 10],
  [244, 122630, 124520, 10],
  [245, 124520, 126440, 11],
  [246, 126440, 128390, 11],
  [247, 128390, 130370, 11],
  [248, 130370, 132380, 11],
  [249, 132380, 134420, 11],
  [250, 134420, 136490, 11],
  [251, 136490, 138590, 12],
  [252, 138590, 140720, 12],
  [253, 140720, 142880, 12],
  [254, 142880, 145070, 12],
  [255, 145070, 147300, 12],
  [256, 147300, 149560, 12],
  [257, 149560, 151850, 13],
  [258, 151850, 154180, 13],
  [259, 154180, 156540, 13],
  [260, 156540, 158940, 13],
  [261, 158940, 161370, 13],
  [262, 161370, 163840, 14],
  [263, 163840, 166350, 14],
  [264, 166350, 168900, 14],
  [265, 168900, 171480, 14],
  [266, 171480, 174100, 14],
  [267, 174100, 176760, 15],
  [268, 176760, 179460, 15],
  [269, 179460, 182200, 15],
  [270, 182200, 184980, 15],
  [271, 184980, 187800, 15],
  [272, 187800, 190670, 16],
  [273, 190670, 193580, 16],
  [274, 193580, 196530, 16],
  [275, 196530, 199530, 16],
  [276, 199530, 202570, 17],
  [277, 202570, 205660, 17],
  [278, 205660, 208790, 17],
  [279, 208790, 211970, 17],
  [280, 211970, 215200, 18],
  [281, 215200, 218480, 18],
  [282, 218480, 221810, 18],
  [283, 221810, 225190, 18],
  [284, 225190, 228620, 19],
  [285, 228620, 232100, 19],
  [286, 232100, 235630, 19],
  [287, 235630, 239210, 19],
  [288, 239210, 242850, 20],
  [289, 242850, 246540, 20],
  [290, 246540, 250290, 20],
  [291, 250290, 254090, 21],
  [292, 254090, 257950, 21],
  [293, 257950, 261870, 21],
  [294, 261870, 265850, 21],
  [295, 265850, 269890, 22],
  [296, 269890, 273990, 22],
  [297, 273990, 278150, 22],
  [298, 278150, 282370, 23],
  [299, 282370, 286660, 23],
  [300, 286660, 291010, 23]
];

/**
 * Calculate the minimum merit score required to earn a given number of merit points
 * @param meritPoints The number of merit points needed
 * @returns The minimum merit score required, or null if the points exceed the maximum possible
 */
export function calculateRequiredMeritScore(meritPoints: number): number | null {
  if (meritPoints <= 0) return 0;
  
  let cumulativePoints = 0;
  
  for (const [, minScore, maxScore, rewardPoints] of MERIT_SCORE_FORMULA) {
    cumulativePoints += rewardPoints;
    
    if (cumulativePoints >= meritPoints) {
      // We need to be in this range
      // Calculate the exact score needed within this range
      // If we need exactly cumulativePoints, we need maxScore
      // If we need less, we interpolate between minScore and maxScore
      
      if (cumulativePoints === meritPoints) {
        return maxScore;
      } else {
        // We need fewer points than this range provides
        // Interpolate within this range
        const pointsNeededInRange = meritPoints - (cumulativePoints - rewardPoints);
        const rangeSize = maxScore - minScore;
        const pointsRatio = pointsNeededInRange / rewardPoints;
        return Math.ceil(minScore + (rangeSize * pointsRatio));
      }
    }
  }
  
  // Points exceed maximum possible
  return null;
}

/**
 * Calculate how many merit points you can earn with a given merit score
 * @param meritScore The merit score you have
 * @returns The total merit points earned
 */
export function calculateMeritPointsFromScore(meritScore: number): number {
  if (meritScore <= 0) return 0;
  
  let totalPoints = 0;
  
  for (const [, minScore, maxScore, rewardPoints] of MERIT_SCORE_FORMULA) {
    if (meritScore >= minScore && meritScore < maxScore) {
      // We're in this range - calculate partial points
      const rangeSize = maxScore - minScore;
      const positionInRange = (meritScore - minScore) / rangeSize;
      return totalPoints + Math.floor(rewardPoints * positionInRange);
    } else if (meritScore >= maxScore) {
      // We've passed this range - add full points
      totalPoints += rewardPoints;
    } else {
      // We haven't reached this range yet
      break;
    }
  }
  
  return totalPoints;
}

